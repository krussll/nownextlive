<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Now &amp; Next Controller</title>
    <link rel="stylesheet" href="/assets/NDST3/controller/styles.css">
</head>
<body>
    <main>
        <div class="layout">
            <aside class="sidebar">
                <div class="sidebar-card">
                    <h2>Displays</h2>
                    <a class="display-link" href="/r/NDST3/index.html" target="_blank" rel="noopener noreferrer">
                        <span>Open NDST3 Display</span>
                        <svg aria-hidden="true" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 5H19V10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M10 14L19 5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M19 14V19H5V5H10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </div>

                <div class="sidebar-card">
                    <h2>Connected Users</h2>
                    <ul class="connections-list" id="connections-list" aria-live="polite">
                        <li class="connections-empty">No connected users yet</li>
                    </ul>
                </div>
            </aside>

            <div class="content">
                <header>
                    <div class="header-row">
                        <div class="header-text">
                            <span>Controller Dashboard</span>
                            <h1>Now &amp; Next â€” North District Sports</h1>
                        </div>
                        <button id="btn">SAVE</button>
                    </div>
                    <p>Enter the live activity details for each space. When you submit, every connected display will refresh instantly.</p>
                </header>

                <div class="status-bar" role="status">
                    <div class="status-pill" id="status-text">Awaiting Connection</div>
                    <div class="status-meta">Room: <strong>NDST3</strong></div>
                </div>

                <section class="space-rows" aria-label="Spaces">
                    <div class="space-row" data-space-row="space1">
                        <div class="space-index">1</div>
                        <div class="space-row-content">
                            <span class="space-row-label" data-row-subtitle="space1">Add time</span>
                            <span class="space-row-time" data-row-time="space1">00:00</span>
                            <span class="space-row-title" data-row-title="space1">Timer 1</span>
                        </div>
                        <div class="space-actions">
                            <button class="icon-button" type="button" aria-label="Start timer for Space 1" data-action="timer">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 8V12L14.5 13.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button" type="button" aria-label="Edit Space 1" data-edit-space="space1">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15H12.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.5 12C19.5 12.53 19.44 13.05 19.34 13.55L21.11 14.89L19.89 17.11L17.92 16.37C17.08 17.23 16.08 17.88 14.97 18.28L14.7 20.5H11.3L11.03 18.28C9.92 17.88 8.92 17.23 8.08 16.37L6.11 17.11L4.89 14.89L6.66 13.55C6.56 13.05 6.5 12.53 6.5 12C6.5 11.47 6.56 10.95 6.66 10.45L4.89 9.11L6.11 6.89L8.08 7.63C8.92 6.77 9.92 6.12 11.03 5.72L11.3 3.5H14.7L14.97 5.72C16.08 6.12 17.08 6.77 17.92 7.63L19.89 6.89L21.11 9.11L19.34 10.45C19.44 10.95 19.5 11.47 19.5 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button icon-button--play" type="button" aria-label="Play Space 1" data-action="play">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-row" data-space-row="space2">
                        <div class="space-index">2</div>
                        <div class="space-row-content">
                            <span class="space-row-label" data-row-subtitle="space2">Add time</span>
                            <span class="space-row-time" data-row-time="space2">00:00</span>
                            <span class="space-row-title" data-row-title="space2">Timer 2</span>
                        </div>
                        <div class="space-actions">
                            <button class="icon-button" type="button" aria-label="Start timer for Space 2" data-action="timer">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 8V12L14.5 13.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button" type="button" aria-label="Edit Space 2" data-edit-space="space2">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15H12.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.5 12C19.5 12.53 19.44 13.05 19.34 13.55L21.11 14.89L19.89 17.11L17.92 16.37C17.08 17.23 16.08 17.88 14.97 18.28L14.7 20.5H11.3L11.03 18.28C9.92 17.88 8.92 17.23 8.08 16.37L6.11 17.11L4.89 14.89L6.66 13.55C6.56 13.05 6.5 12.53 6.5 12C6.5 11.47 6.56 10.95 6.66 10.45L4.89 9.11L6.11 6.89L8.08 7.63C8.92 6.77 9.92 6.12 11.03 5.72L11.3 3.5H14.7L14.97 5.72C16.08 6.12 17.08 6.77 17.92 7.63L19.89 6.89L21.11 9.11L19.34 10.45C19.44 10.95 19.5 11.47 19.5 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button icon-button--play" type="button" aria-label="Play Space 2" data-action="play">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-row" data-space-row="space3">
                        <div class="space-index">3</div>
                        <div class="space-row-content">
                            <span class="space-row-label" data-row-subtitle="space3">Add time</span>
                            <span class="space-row-time" data-row-time="space3">00:00</span>
                            <span class="space-row-title" data-row-title="space3">Timer 3</span>
                        </div>
                        <div class="space-actions">
                            <button class="icon-button" type="button" aria-label="Start timer for Space 3" data-action="timer">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 8V12L14.5 13.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button" type="button" aria-label="Edit Space 3" data-edit-space="space3">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15H12.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.5 12C19.5 12.53 19.44 13.05 19.34 13.55L21.11 14.89L19.89 17.11L17.92 16.37C17.08 17.23 16.08 17.88 14.97 18.28L14.7 20.5H11.3L11.03 18.28C9.92 17.88 8.92 17.23 8.08 16.37L6.11 17.11L4.89 14.89L6.66 13.55C6.56 13.05 6.5 12.53 6.5 12C6.5 11.47 6.56 10.95 6.66 10.45L4.89 9.11L6.11 6.89L8.08 7.63C8.92 6.77 9.92 6.12 11.03 5.72L11.3 3.5H14.7L14.97 5.72C16.08 6.12 17.08 6.77 17.92 7.63L19.89 6.89L21.11 9.11L19.34 10.45C19.44 10.95 19.5 11.47 19.5 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button icon-button--play" type="button" aria-label="Play Space 3" data-action="play">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-row" data-space-row="space4">
                        <div class="space-index">4</div>
                        <div class="space-row-content">
                            <span class="space-row-label" data-row-subtitle="space4">Add time</span>
                            <span class="space-row-time" data-row-time="space4">00:00</span>
                            <span class="space-row-title" data-row-title="space4">Timer 4</span>
                        </div>
                        <div class="space-actions">
                            <button class="icon-button" type="button" aria-label="Start timer for Space 4" data-action="timer">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 8V12L14.5 13.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button" type="button" aria-label="Edit Space 4" data-edit-space="space4">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15H12.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.5 12C19.5 12.53 19.44 13.05 19.34 13.55L21.11 14.89L19.89 17.11L17.92 16.37C17.08 17.23 16.08 17.88 14.97 18.28L14.7 20.5H11.3L11.03 18.28C9.92 17.88 8.92 17.23 8.08 16.37L6.11 17.11L4.89 14.89L6.66 13.55C6.56 13.05 6.5 12.53 6.5 12C6.5 11.47 6.56 10.95 6.66 10.45L4.89 9.11L6.11 6.89L8.08 7.63C8.92 6.77 9.92 6.12 11.03 5.72L11.3 3.5H14.7L14.97 5.72C16.08 6.12 17.08 6.77 17.92 7.63L19.89 6.89L21.11 9.11L19.34 10.45C19.44 10.95 19.5 11.47 19.5 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button icon-button--play" type="button" aria-label="Play Space 4" data-action="play">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-row" data-space-row="space5">
                        <div class="space-index">5</div>
                        <div class="space-row-content">
                            <span class="space-row-label" data-row-subtitle="space5">Add time</span>
                            <span class="space-row-time" data-row-time="space5">00:00</span>
                            <span class="space-row-title" data-row-title="space5">Timer 5</span>
                        </div>
                        <div class="space-actions">
                            <button class="icon-button" type="button" aria-label="Start timer for Space 5" data-action="timer">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 8V12L14.5 13.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button" type="button" aria-label="Edit Space 5" data-edit-space="space5">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15H12.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.5 12C19.5 12.53 19.44 13.05 19.34 13.55L21.11 14.89L19.89 17.11L17.92 16.37C17.08 17.23 16.08 17.88 14.97 18.28L14.7 20.5H11.3L11.03 18.28C9.92 17.88 8.92 17.23 8.08 16.37L6.11 17.11L4.89 14.89L6.66 13.55C6.56 13.05 6.5 12.53 6.5 12C6.5 11.47 6.56 10.95 6.66 10.45L4.89 9.11L6.11 6.89L8.08 7.63C8.92 6.77 9.92 6.12 11.03 5.72L11.3 3.5H14.7L14.97 5.72C16.08 6.12 17.08 6.77 17.92 7.63L19.89 6.89L21.11 9.11L19.34 10.45C19.44 10.95 19.5 11.47 19.5 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button icon-button--play" type="button" aria-label="Play Space 5" data-action="play">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="space-row" data-space-row="space6">
                        <div class="space-index">6</div>
                        <div class="space-row-content">
                            <span class="space-row-label" data-row-subtitle="space6">Add time</span>
                            <span class="space-row-time" data-row-time="space6">00:00</span>
                            <span class="space-row-title" data-row-title="space6">Timer 6</span>
                        </div>
                        <div class="space-actions">
                            <button class="icon-button" type="button" aria-label="Start timer for Space 6" data-action="timer">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 8V12L14.5 13.5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button" type="button" aria-label="Edit Space 6" data-edit-space="space6">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 15H12.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M19.5 12C19.5 12.53 19.44 13.05 19.34 13.55L21.11 14.89L19.89 17.11L17.92 16.37C17.08 17.23 16.08 17.88 14.97 18.28L14.7 20.5H11.3L11.03 18.28C9.92 17.88 8.92 17.23 8.08 16.37L6.11 17.11L4.89 14.89L6.66 13.55C6.56 13.05 6.5 12.53 6.5 12C6.5 11.47 6.56 10.95 6.66 10.45L4.89 9.11L6.11 6.89L8.08 7.63C8.92 6.77 9.92 6.12 11.03 5.72L11.3 3.5H14.7L14.97 5.72C16.08 6.12 17.08 6.77 17.92 7.63L19.89 6.89L21.11 9.11L19.34 10.45C19.44 10.95 19.5 11.47 19.5 12Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="icon-button icon-button--play" type="button" aria-label="Play Space 6" data-action="play">
                                <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 5V19L19 12L8 5Z" fill="currentColor"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </section>

                <div class="space-form-storage" aria-hidden="true">
                    <section class="spaces-grid hidden-fields">
            <details class="space-card" open>
                <summary>
                    <div class="space-summary">
                        <h2 data-space-heading="space1">Space 1</h2>
                        <span class="summary-hint">Toggle to show or hide fields</span>
                    </div>
                </summary>
                <div class="space-fields">
                    <label class="space-name" for="space1-title">Space Name
                        <input type="text" id="space1-title" name="space1-title" placeholder="Space 1" value="Space 1">
                    </label>
                    <details class="event-block" open>
                        <summary>Now</summary>
                        <div class="event-fields">
                            <label for="space1-now">Session Title
                                                        <input type="text" id="space1-now" name="space1-now-title" placeholder="e.g. Junior Netball Finals">
                                                    </label>
                                                    <label for="space1-now-time">Time
                                                        <input type="text" id="space1-now-time" name="space1-now-time" placeholder="e.g. 09:00">
                                                    </label>
                                                    <label for="space1-now-description">Details
                                                        <textarea id="space1-now-description" name="space1-now-description" placeholder="Include team names, coaches, or key notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Next</summary>
                        <div class="event-fields">
                            <label for="space1-next">Session Title
                                                        <input type="text" id="space1-next" name="space1-next-title" placeholder="e.g. Senior Warm-Up">
                                                    </label>
                                                    <label for="space1-next-time">Time
                                                        <input type="text" id="space1-next-time" name="space1-next-time" placeholder="e.g. 10:00">
                                                    </label>
                                                    <label for="space1-next-description">Details
                                                        <textarea id="space1-next-description" name="space1-next-description" placeholder="Start time, participants, or other info"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 1</summary>
                        <div class="event-fields">
                            <label for="space1-upcoming1">Session Title
                                                        <input type="text" id="space1-upcoming1" name="space1-upcoming1-title" placeholder="e.g. Skills Workshop">
                                                    </label>
                                                    <label for="space1-upcoming1-time">Time
                                                        <input type="text" id="space1-upcoming1-time" name="space1-upcoming1-time" placeholder="e.g. 11:00">
                                                    </label>
                                                    <label for="space1-upcoming1-description">Details
                                                        <textarea id="space1-upcoming1-description" name="space1-upcoming1-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 2</summary>
                        <div class="event-fields">
                            <label for="space1-upcoming2">Session Title
                                                        <input type="text" id="space1-upcoming2" name="space1-upcoming2-title" placeholder="e.g. Open Court Session">
                                                    </label>
                                                    <label for="space1-upcoming2-time">Time
                                                        <input type="text" id="space1-upcoming2-time" name="space1-upcoming2-time" placeholder="e.g. 12:00">
                                                    </label>
                                                    <label for="space1-upcoming2-description">Details
                                                        <textarea id="space1-upcoming2-description" name="space1-upcoming2-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                </div>
            </details>

            <details class="space-card">
                <summary>
                    <div class="space-summary">
                        <h2 data-space-heading="space2">Space 2</h2>
                        <span class="summary-hint">Toggle to show or hide fields</span>
                    </div>
                </summary>
                <div class="space-fields">
                    <label class="space-name" for="space2-title">Space Name
                        <input type="text" id="space2-title" name="space2-title" placeholder="Space 2" value="Space 2">
                    </label>
                    <details class="event-block" open>
                        <summary>Now</summary>
                        <div class="event-fields">
                            <label for="space2-now">Session Title
                                                        <input type="text" id="space2-now" name="space2-now-title" placeholder="e.g. Skills Workshop">
                                                    </label>
                                                    <label for="space2-now-time">Time
                                                        <input type="text" id="space2-now-time" name="space2-now-time" placeholder="e.g. 09:00">
                                                    </label>
                                                    <label for="space2-now-description">Details
                                                        <textarea id="space2-now-description" name="space2-now-description" placeholder="Include team names, coaches, or key notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Next</summary>
                        <div class="event-fields">
                            <label for="space2-next">Session Title
                                                        <input type="text" id="space2-next" name="space2-next-title" placeholder="e.g. Open Court Session">
                                                    </label>
                                                    <label for="space2-next-time">Time
                                                        <input type="text" id="space2-next-time" name="space2-next-time" placeholder="e.g. 10:00">
                                                    </label>
                                                    <label for="space2-next-description">Details
                                                        <textarea id="space2-next-description" name="space2-next-description" placeholder="Start time, participants, or other info"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 1</summary>
                        <div class="event-fields">
                            <label for="space2-upcoming1">Session Title
                                                        <input type="text" id="space2-upcoming1" name="space2-upcoming1-title" placeholder="e.g. Community Pickup Game">
                                                    </label>
                                                    <label for="space2-upcoming1-time">Time
                                                        <input type="text" id="space2-upcoming1-time" name="space2-upcoming1-time" placeholder="e.g. 11:00">
                                                    </label>
                                                    <label for="space2-upcoming1-description">Details
                                                        <textarea id="space2-upcoming1-description" name="space2-upcoming1-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 2</summary>
                        <div class="event-fields">
                            <label for="space2-upcoming2">Session Title
                                                        <input type="text" id="space2-upcoming2" name="space2-upcoming2-title" placeholder="e.g. Youth Training">
                                                    </label>
                                                    <label for="space2-upcoming2-time">Time
                                                        <input type="text" id="space2-upcoming2-time" name="space2-upcoming2-time" placeholder="e.g. 12:00">
                                                    </label>
                                                    <label for="space2-upcoming2-description">Details
                                                        <textarea id="space2-upcoming2-description" name="space2-upcoming2-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                </div>
            </details>

            <details class="space-card">
                <summary>
                    <div class="space-summary">
                        <h2 data-space-heading="space3">Space 3</h2>
                        <span class="summary-hint">Toggle to show or hide fields</span>
                    </div>
                </summary>
                <div class="space-fields">
                    <label class="space-name" for="space3-title">Space Name
                        <input type="text" id="space3-title" name="space3-title" placeholder="Space 3" value="Space 3">
                    </label>
                    <details class="event-block" open>
                        <summary>Now</summary>
                        <div class="event-fields">
                            <label for="space3-now">Session Title
                                                        <input type="text" id="space3-now" name="space3-now-title" placeholder="e.g. Open Court Session">
                                                    </label>
                                                    <label for="space3-now-time">Time
                                                        <input type="text" id="space3-now-time" name="space3-now-time" placeholder="e.g. 09:00">
                                                    </label>
                                                    <label for="space3-now-description">Details
                                                        <textarea id="space3-now-description" name="space3-now-description" placeholder="Include team names, coaches, or key notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Next</summary>
                        <div class="event-fields">
                            <label for="space3-next">Session Title
                                                        <input type="text" id="space3-next" name="space3-next-title" placeholder="e.g. Youth Training">
                                                    </label>
                                                    <label for="space3-next-time">Time
                                                        <input type="text" id="space3-next-time" name="space3-next-time" placeholder="e.g. 10:00">
                                                    </label>
                                                    <label for="space3-next-description">Details
                                                        <textarea id="space3-next-description" name="space3-next-description" placeholder="Start time, participants, or other info"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 1</summary>
                        <div class="event-fields">
                            <label for="space3-upcoming1">Session Title
                                                        <input type="text" id="space3-upcoming1" name="space3-upcoming1-title" placeholder="e.g. Senior Warm-Up">
                                                    </label>
                                                    <label for="space3-upcoming1-time">Time
                                                        <input type="text" id="space3-upcoming1-time" name="space3-upcoming1-time" placeholder="e.g. 11:00">
                                                    </label>
                                                    <label for="space3-upcoming1-description">Details
                                                        <textarea id="space3-upcoming1-description" name="space3-upcoming1-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 2</summary>
                        <div class="event-fields">
                            <label for="space3-upcoming2">Session Title
                                                        <input type="text" id="space3-upcoming2" name="space3-upcoming2-title" placeholder="e.g. Skills Workshop">
                                                    </label>
                                                    <label for="space3-upcoming2-time">Time
                                                        <input type="text" id="space3-upcoming2-time" name="space3-upcoming2-time" placeholder="e.g. 12:00">
                                                    </label>
                                                    <label for="space3-upcoming2-description">Details
                                                        <textarea id="space3-upcoming2-description" name="space3-upcoming2-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                </div>
            </details>

            <details class="space-card">
                <summary>
                    <div class="space-summary">
                        <h2 data-space-heading="space4">Space 4</h2>
                        <span class="summary-hint">Toggle to show or hide fields</span>
                    </div>
                </summary>
                <div class="space-fields">
                    <label class="space-name" for="space4-title">Space Name
                        <input type="text" id="space4-title" name="space4-title" placeholder="Space 4" value="Space 4">
                    </label>
                    <details class="event-block" open>
                        <summary>Now</summary>
                        <div class="event-fields">
                            <label for="space4-now">Session Title
                                                        <input type="text" id="space4-now" name="space4-now-title" placeholder="e.g. Youth Training">
                                                    </label>
                                                    <label for="space4-now-time">Time
                                                        <input type="text" id="space4-now-time" name="space4-now-time" placeholder="e.g. 09:00">
                                                    </label>
                                                    <label for="space4-now-description">Details
                                                        <textarea id="space4-now-description" name="space4-now-description" placeholder="Include team names, coaches, or key notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Next</summary>
                        <div class="event-fields">
                            <label for="space4-next">Session Title
                                                        <input type="text" id="space4-next" name="space4-next-title" placeholder="e.g. Senior Warm-Up">
                                                    </label>
                                                    <label for="space4-next-time">Time
                                                        <input type="text" id="space4-next-time" name="space4-next-time" placeholder="e.g. 10:00">
                                                    </label>
                                                    <label for="space4-next-description">Details
                                                        <textarea id="space4-next-description" name="space4-next-description" placeholder="Start time, participants, or other info"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 1</summary>
                        <div class="event-fields">
                            <label for="space4-upcoming1">Session Title
                                                        <input type="text" id="space4-upcoming1" name="space4-upcoming1-title" placeholder="e.g. Youth Training">
                                                    </label>
                                                    <label for="space4-upcoming1-time">Time
                                                        <input type="text" id="space4-upcoming1-time" name="space4-upcoming1-time" placeholder="e.g. 11:00">
                                                    </label>
                                                    <label for="space4-upcoming1-description">Details
                                                        <textarea id="space4-upcoming1-description" name="space4-upcoming1-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 2</summary>
                        <div class="event-fields">
                            <label for="space4-upcoming2">Session Title
                                                        <input type="text" id="space4-upcoming2" name="space4-upcoming2-title" placeholder="e.g. Community Pickup Game">
                                                    </label>
                                                    <label for="space4-upcoming2-time">Time
                                                        <input type="text" id="space4-upcoming2-time" name="space4-upcoming2-time" placeholder="e.g. 12:00">
                                                    </label>
                                                    <label for="space4-upcoming2-description">Details
                                                        <textarea id="space4-upcoming2-description" name="space4-upcoming2-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                </div>
            </details>

            <details class="space-card">
                <summary>
                    <div class="space-summary">
                        <h2 data-space-heading="space5">Space 5</h2>
                        <span class="summary-hint">Toggle to show or hide fields</span>
                    </div>
                </summary>
                <div class="space-fields">
                    <label class="space-name" for="space5-title">Space Name
                        <input type="text" id="space5-title" name="space5-title" placeholder="Space 5" value="Space 5">
                    </label>
                    <details class="event-block" open>
                        <summary>Now</summary>
                        <div class="event-fields">
                            <label for="space5-now">Session Title
                                                        <input type="text" id="space5-now" name="space5-now-title" placeholder="e.g. Youth Training">
                                                    </label>
                                                    <label for="space5-now-time">Time
                                                        <input type="text" id="space5-now-time" name="space5-now-time" placeholder="e.g. 09:00">
                                                    </label>
                                                    <label for="space5-now-description">Details
                                                        <textarea id="space5-now-description" name="space5-now-description" placeholder="Include team names, coaches, or key notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Next</summary>
                        <div class="event-fields">
                            <label for="space5-next">Session Title
                                                        <input type="text" id="space5-next" name="space5-next-title" placeholder="e.g. Community Pickup Game">
                                                    </label>
                                                    <label for="space5-next-time">Time
                                                        <input type="text" id="space5-next-time" name="space5-next-time" placeholder="e.g. 10:00">
                                                    </label>
                                                    <label for="space5-next-description">Details
                                                        <textarea id="space5-next-description" name="space5-next-description" placeholder="Start time, participants, or other info"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 1</summary>
                        <div class="event-fields">
                            <label for="space5-upcoming1">Session Title
                                                        <input type="text" id="space5-upcoming1" name="space5-upcoming1-title" placeholder="e.g. Senior Warm-Up">
                                                    </label>
                                                    <label for="space5-upcoming1-time">Time
                                                        <input type="text" id="space5-upcoming1-time" name="space5-upcoming1-time" placeholder="e.g. 11:00">
                                                    </label>
                                                    <label for="space5-upcoming1-description">Details
                                                        <textarea id="space5-upcoming1-description" name="space5-upcoming1-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 2</summary>
                        <div class="event-fields">
                            <label for="space5-upcoming2">Session Title
                                                        <input type="text" id="space5-upcoming2" name="space5-upcoming2-title" placeholder="e.g. Open Court Session">
                                                    </label>
                                                    <label for="space5-upcoming2-time">Time
                                                        <input type="text" id="space5-upcoming2-time" name="space5-upcoming2-time" placeholder="e.g. 12:00">
                                                    </label>
                                                    <label for="space5-upcoming2-description">Details
                                                        <textarea id="space5-upcoming2-description" name="space5-upcoming2-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                </div>
            </details>

            <details class="space-card">
                <summary>
                    <div class="space-summary">
                        <h2 data-space-heading="space6">Space 6</h2>
                        <span class="summary-hint">Toggle to show or hide fields</span>
                    </div>
                </summary>
                <div class="space-fields">
                    <label class="space-name" for="space6-title">Space Name
                        <input type="text" id="space6-title" name="space6-title" placeholder="Space 6" value="Space 6">
                    </label>
                    <details class="event-block" open>
                        <summary>Now</summary>
                        <div class="event-fields">
                            <label for="space6-now">Session Title
                                                        <input type="text" id="space6-now" name="space6-now-title" placeholder="e.g. Volunteer Briefing">
                                                    </label>
                                                    <label for="space6-now-time">Time
                                                        <input type="text" id="space6-now-time" name="space6-now-time" placeholder="e.g. 09:00">
                                                    </label>
                                                    <label for="space6-now-description">Details
                                                        <textarea id="space6-now-description" name="space6-now-description" placeholder="Include team names, coaches, or key notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Next</summary>
                        <div class="event-fields">
                            <label for="space6-next">Session Title
                                                        <input type="text" id="space6-next" name="space6-next-title" placeholder="e.g. Courts Preparation">
                                                    </label>
                                                    <label for="space6-next-time">Time
                                                        <input type="text" id="space6-next-time" name="space6-next-time" placeholder="e.g. 10:00">
                                                    </label>
                                                    <label for="space6-next-description">Details
                                                        <textarea id="space6-next-description" name="space6-next-description" placeholder="Start time, participants, or other info"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 1</summary>
                        <div class="event-fields">
                            <label for="space6-upcoming1">Session Title
                                                        <input type="text" id="space6-upcoming1" name="space6-upcoming1-title" placeholder="e.g. Junior Netball Finals">
                                                    </label>
                                                    <label for="space6-upcoming1-time">Time
                                                        <input type="text" id="space6-upcoming1-time" name="space6-upcoming1-time" placeholder="e.g. 11:00">
                                                    </label>
                                                    <label for="space6-upcoming1-description">Details
                                                        <textarea id="space6-upcoming1-description" name="space6-upcoming1-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                    <details class="event-block" open>
                        <summary>Event 2</summary>
                        <div class="event-fields">
                            <label for="space6-upcoming2">Session Title
                                                        <input type="text" id="space6-upcoming2" name="space6-upcoming2-title" placeholder="e.g. Senior Warm-Up">
                                                    </label>
                                                    <label for="space6-upcoming2-time">Time
                                                        <input type="text" id="space6-upcoming2-time" name="space6-upcoming2-time" placeholder="e.g. 12:00">
                                                    </label>
                                                    <label for="space6-upcoming2-description">Details
                                                        <textarea id="space6-upcoming2-description" name="space6-upcoming2-description" placeholder="Additional notes"></textarea>
                                                    </label>
                        </div>
                    </details>
                </div>
            </details>
                    </section>
                </div>

            </div>
        </div>
    </main>

    <div class="modal" id="editor-modal" hidden>
        <div class="modal-backdrop" data-close-modal></div>
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
            <div class="modal-header">
                <h2 id="modal-title">Edit Space</h2>
                <button class="icon-button" type="button" aria-label="Close" data-close-modal>
                    <svg aria-hidden="true" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 6L18 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 18L18 6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer">
                <button class="btn-secondary" type="button" data-close-modal>Cancel</button>
                <button class="btn-primary" type="button" id="confirm-modal">Confirm</button>
            </div>
        </div>
    </div>
</body>
<script type="module">
    const status = document.getElementById("status-text");
    const submitButton = document.getElementById("btn");
    const connectionsList = document.getElementById("connections-list");
    const modal = document.getElementById("editor-modal");
    const modalBody = document.getElementById("modal-body");
    const modalTitle = document.getElementById("modal-title");
    const confirmModal = document.getElementById("confirm-modal");

    const spaceIds = Array.from({ length: 6 }, (_, index) => `space${index + 1}`);
    const eventKeys = [
        { key: "now" },
        { key: "next" },
        { key: "upcoming1" },
        { key: "upcoming2" },
    ];

    const fields = spaceIds.reduce((spaceAcc, spaceId) => {
        const events = eventKeys.reduce((eventAcc, { key }) => {
            eventAcc[key] = {
                title: document.getElementById(`${spaceId}-${key}`),
                subtitle: document.getElementById(`${spaceId}-${key}-description`),
                time: document.getElementById(`${spaceId}-${key}-time`),
            };
            return eventAcc;
        }, {});

        spaceAcc[spaceId] = events;
        return spaceAcc;
    }, {});

    const spaceTitleInputs = spaceIds.reduce((acc, spaceId) => {
        acc[spaceId] = document.getElementById(`${spaceId}-title`);
        return acc;
    }, {});

    const spaceTitleDisplays = spaceIds.reduce((acc, spaceId) => {
        acc[spaceId] = document.querySelector(`[data-space-heading="${spaceId}"]`);
        return acc;
    }, {});

    const defaultSpaceTitle = (index) => `Space ${index + 1}`;

    const updateSpaceTitleDisplay = (spaceKey, index, value) => {
        const display = spaceTitleDisplays[spaceKey];
        const normalizedValue = value ?? spaceTitleInputs[spaceKey]?.value ?? "";
        const title = (normalizedValue ?? "").toString().trim() || defaultSpaceTitle(index);

        if (display) {
            display.textContent = title;
        }

        return title;
    };

    const setSpaceTitle = (spaceKey, index, value) => {
        const input = spaceTitleInputs[spaceKey];
        if (input && value !== undefined) {
            input.value = value ?? "";
        }

        return updateSpaceTitleDisplay(spaceKey, index, value);
    };

    const getSpaceTitle = (spaceKey, index) => updateSpaceTitleDisplay(spaceKey, index);

    spaceIds.forEach((spaceKey, index) => {
        const input = spaceTitleInputs[spaceKey];
        if (input) {
            input.addEventListener("input", () => {
                updateSpaceTitleDisplay(spaceKey, index, input.value);
                updateRowSummary(spaceKey, index);
            });

            updateSpaceTitleDisplay(spaceKey, index, input.value);
        } else {
            updateSpaceTitleDisplay(spaceKey, index);
        }
    });

    import { io } from "https://cdn.socket.io/4.8.1/socket.io.esm.min.js";

    const socket = io("https://hidden-journey-22873-ad31037ba953.herokuapp.com");

    const setFieldValue = (field, value) => {
        if (field) {
            field.value = value ?? "";
        }
    };

    const populateSpace = (spaceKey, data = {}) => {
        eventKeys.forEach(({ key }) => {
            const refs = fields[spaceKey]?.[key];
            const incoming = data[key] ?? {};
            if (!refs) return;

            setFieldValue(refs.title, incoming.title);
            setFieldValue(refs.subtitle, incoming.subtitle);
            setFieldValue(refs.time, incoming.time);
        });
    };

    const buildEventPayload = (spaceKey) => {
        const events = {};
        eventKeys.forEach(({ key }) => {
            const refs = fields[spaceKey]?.[key];
            if (!refs) return;
            events[key] = {
                title: refs.title?.value ?? "",
                subtitle: refs.subtitle?.value ?? "",
                time: refs.time?.value ?? "",
            };
        });
        return events;
    };

    const rowRefs = spaceIds.reduce((acc, spaceId) => {
        const row = document.querySelector(`[data-space-row="${spaceId}"]`);
        acc[spaceId] = {
            row,
            subtitle: row?.querySelector(`[data-row-subtitle="${spaceId}"]`),
            time: row?.querySelector(`[data-row-time="${spaceId}"]`),
            title: row?.querySelector(`[data-row-title="${spaceId}"]`),
        };
        return acc;
    }, {});

    const defaultRowSubtitle = "Add time";
    const defaultRowTime = "00:00";

    const updateRowSummary = (spaceKey, index = 0) => {
        const refs = rowRefs[spaceKey];
        if (!refs) return;

        const nextRefs = fields[spaceKey]?.next;
        const subtitleValue = nextRefs?.subtitle?.value?.trim();
        const timeValue = nextRefs?.time?.value?.trim();
        const titleValue = nextRefs?.title?.value?.trim();
        const spaceTitle = getSpaceTitle(spaceKey, index);

        if (refs.subtitle) {
            refs.subtitle.textContent = subtitleValue || defaultRowSubtitle;
        }

        if (refs.time) {
            refs.time.textContent = timeValue || defaultRowTime;
        }

        if (refs.title) {
            refs.title.textContent = titleValue || spaceTitle;
        }
    };

    const modalState = {
        activeSpace: null,
        previousValues: null,
    };

    const hiddenFormContainer = document.querySelector(".space-form-storage");

    const spaceForms = spaceIds.reduce((acc, spaceId) => {
        acc[spaceId] = hiddenFormContainer?.querySelector(`[data-space-heading="${spaceId}"]`)?.closest("details");
        return acc;
    }, {});

    const closeModal = () => {
        modal?.setAttribute("hidden", "true");
        modal?.classList.remove("is-visible");
        modalState.activeSpace = null;
        modalState.previousValues = null;
    };

    const moveFormToStorage = (spaceKey) => {
        const form = spaceForms[spaceKey];
        if (form && hiddenFormContainer && !hiddenFormContainer.contains(form)) {
            hiddenFormContainer.appendChild(form);
        }
    };

    const openModalForSpace = (spaceKey) => {
        const form = spaceForms[spaceKey];
        const index = spaceIds.indexOf(spaceKey);
        if (!form || !modal || !modalBody) return;

        modalState.activeSpace = spaceKey;
        modalState.previousValues = {
            title: getSpaceTitle(spaceKey, index),
            events: buildEventPayload(spaceKey),
        };

        modalBody.innerHTML = "";
        modalBody.appendChild(form);
        form.open = true;
        modal.removeAttribute("hidden");
        modal.classList.add("is-visible");
        modalTitle.textContent = `Edit ${getSpaceTitle(spaceKey, index)}`;
    };

    const restorePreviousValues = () => {
        const { activeSpace, previousValues } = modalState;
        if (!activeSpace || !previousValues) return;

        const index = spaceIds.indexOf(activeSpace);
        setSpaceTitle(activeSpace, index, previousValues.title);
        populateSpace(activeSpace, previousValues.events);
        updateRowSummary(activeSpace, index);
    };

    const handleConfirm = () => {
        const { activeSpace } = modalState;
        if (!activeSpace) return;

        const index = spaceIds.indexOf(activeSpace);
        updateRowSummary(activeSpace, index);
        moveFormToStorage(activeSpace);
        closeModal();
    };

    const handleCancel = () => {
        const { activeSpace } = modalState;
        if (!activeSpace) return;

        restorePreviousValues();
        moveFormToStorage(activeSpace);
        closeModal();
    };

    document.querySelectorAll("[data-close-modal]").forEach((button) => {
        button.addEventListener("click", handleCancel);
    });

    confirmModal?.addEventListener("click", handleConfirm);

    document.querySelectorAll("[data-edit-space]").forEach((button) => {
        button.addEventListener("click", () => {
            const spaceKey = button.getAttribute("data-edit-space");
            openModalForSpace(spaceKey);
        });
    });

    socket.on("connect", () => {
        socket.emit("room-request", { room: "NDST3", role: "CONTROLLER" });
    });

    const normalizeConnections = (payload = {}) => {
        if (!payload) return [];

        const directConnections = payload.connections ?? payload.users ?? payload.members ?? payload.participants;
        if (Array.isArray(directConnections)) return directConnections;

        const fromRoles = [];
        const roleMappings = [
            { key: "controllers", role: "controller" },
            { key: "controller", role: "controller" },
            { key: "displays", role: "display" },
            { key: "display", role: "display" },
        ];

        roleMappings.forEach(({ key, role }) => {
            const entries = payload[key];
            if (Array.isArray(entries)) {
                entries.forEach((id) => {
                    fromRoles.push({ id, role });
                });
            }
        });

        return fromRoles;
    };

    const renderConnections = (connections = []) => {
        if (!connectionsList) return;
        connectionsList.innerHTML = "";

        if (!connections.length) {
            const empty = document.createElement("li");
            empty.className = "connections-empty";
            empty.textContent = "No connected users yet";
            connectionsList.appendChild(empty);
            return;
        }

        connections.forEach(({ id, role }) => {
            const item = document.createElement("li");
            item.className = "connection-item";

            const idLabel = document.createElement("span");
            idLabel.className = "connection-id";
            idLabel.textContent = id ?? "Unknown ID";

            const roleLabel = document.createElement("span");
            const normalizedRole = role ? role.toString().toLowerCase() : "unknown";
            roleLabel.className = `connection-role ${role ? `connection-role--${normalizedRole}` : ""}`;
            roleLabel.textContent = normalizedRole;

            item.appendChild(idLabel);
            item.appendChild(roleLabel);
            connectionsList.appendChild(item);
        });
    };

    socket.on("room-status", (payload) => {
        renderConnections(normalizeConnections(payload));
    });

    socket.on("init-load", (config) => {
        status.textContent = "Connected";
        spaceIds.forEach((spaceKey, index) => {
            const incoming = config[`space${index + 1}`];
            setSpaceTitle(spaceKey, index, incoming?.title);
            populateSpace(spaceKey, incoming);
            updateRowSummary(spaceKey, index);
        });
    });

    submitButton.addEventListener("click", () => {
        const payload = { data: {} };

        spaceIds.forEach((spaceKey, index) => {
            payload.data[`space${index + 1}`] = {
                title: getSpaceTitle(spaceKey, index),
                ...buildEventPayload(spaceKey),
            };
        });

        socket.emit("save", payload);
    });

    spaceIds.forEach((spaceKey, index) => updateRowSummary(spaceKey, index));
</script>
</html>
